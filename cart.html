<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPHYRA</title>
    <script src="https://kit.fontawesome.com/fc393adae9.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/cart.css">
    <script src="./js/jquery-3.6.0.min.js"></script>
</head>
<body>
    <a href="#" class="b_to_t">︿</a>
    <!-- header -->
    <header>
        <a href="index.html" class="logo">
            <img src="./img/Logo.svg" alt="" style="height:50px">
        </a>
        <!--導覽選單  -->
        <i class="fa-solid fa-bars bars"></i>
        <nav>
            <ul>
                <li><a href="news.html">最新消息</a></li>
                <li><a href="directions.html">產地</a></li>
                <li><a href="productlist.html">各式商品</a></li>
                <li><a href="place.html">銷售據點</a></li>
                <li><a href="about.html">關於我們</a></li>
            </ul>
    
        </nav>
        <!-- 功能選單 -->
        <div class="icon">
            <nav>
                <ul>
                    <li><a href="#"><img src="./img/icon_t.svg" alt="" class="t_i_1"></a></li>
                    <li><a href="#"><img src="./img/icon_t.svg" alt="" class="t_i_2"></a></li>
                    <li><a href="cart.html"><img src="./img/icon_t.svg" alt="" class="t_i_3"><p class="cart_count">0</p></a></li>
                </ul>
            </nav>
        </div>
    </header>
    <!-- 頁面內容 -->
    <div class="all_main p_main" >
        <article>
            <ul>
                <li><a href="index.html">首頁</a></li>
                <p>　\　</p>
                <li><a href="#">購物車</a></li>
            </ul>
            <div>
                <h2>購物車</h2>
            </div>
        </article>

        <!-- 這裡開始 -->
        <main class="c_main">
            <div class="c_left">
                <ul class="c_list">
                    <!-- <li>
                        <div class="c_pic">
                            <img src="./img/jewel_.jpg" alt="">
                        </div>
                        <h4>品名</h4>
                        <div class="c_btn">
                            <button> - </button>
                            <input type="text" placeholder="數量">
                            <button>+</button>
                        </div>
                        <div>
                            <p>NT$ 00,000</p>
                            <button>移除</button>
                        </div>
                    </li>
                     -->
                </ul>
                <div class="c_text">
                    <p>總計</p>
                    <p class="total">NT$ 00,000</p>
                </div>
                <ul class="c_check">
                    <li><a href="productlist.html">繼續選購</a></li>
                    <li><a href="#">結帳</a></li>
                </ul>   
            </div>
            <div class="c_right">
                <ul>
                    <p>您也可以看看</p>
                    <li><a href="product.html"><img src="./img/com04.jpg" alt=""></a></li>
                    <li><a href="product.html"><img src="./img/jewel_.jpg" alt=""></a></li>
                    <li><a href="product.html"><img src="./img/jewel02.jpg" alt=""></a></li>
                </ul>
            </div>
        </main>
    </div>
    <!-- footer -->
    <footer>
        <!-- 列*3 -->
        <article>
            <nav>
                <p>服務資訊</p>
                <ul>
                    <li><a href="#">聯絡我們</a></li>
                    <li><a href="#">訂單查詢</a></li>
                    <li><a href="#">退貨</a></li>
                    <li><a href="#">常見問題</a></li>
                </ul>
            </nav>
            <nav>
                <p>服務資訊</p>
                <ul>
                    <li><a href="#">聯絡我們</a></li>
                    <li><a href="#">常見問題</a></li>
                    <li><a href="#">訂單查詢</a></li>
                </ul>
                
            </nav>
            <nav>
                <p>法律條款</p>
                <ul>
                    <li><a href="#">隱私政策</a></li>
                    <li><a href="#">Cookie政策</a></li>
                    <li><a href="#">銷售條款</a></li>
                </ul>
            </nav>
        
        
            <!-- 輸入 -->
            <div class="input">
                <p>訂閱最新資訊</p>
                <input type="text" placeholder="輸入您的電子信箱">
                <a href="#" class="ipt"><img src="./img/Vec.svg" alt=""></a>
            </div>
        </article>
        <!-- P -->
        <div class="f_bottom">
            <div class="f_">
                <p>本網站為緯育TibaMe前端設計工程師班第74期學員專題作品，本平台僅供學習、展示之用。
                    <br>若有侵權疑慮，您可以私訊[TibaMe-前端設計工程師養成班]，後續會由專人協助處理
                    <br>參考資源:
                </p>
                <a href="https://www.pinterest.com/" class="f_a1">pinterest</a>
                <a href="https://www.pexels.com/zh-tw/search/stone/" class="f_a2">pexels</a>
                
            </div>
            <div class="icon">
                <ul>
                    <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
                    <li><a href="#"><i class="fa-brands fa-facebook-square"></i></a></li>
                    <li><a href="#"><i class="fa-brands fa-twitter"></i></a></li>
                </ul>
            </div>
        </div>
        
    </footer>
    <script src="./js/index.js"></script>
    <script>
        $(function(){
            get_item();
        });
        
        function get_item(){
            let lists =JSON.parse(sessionStorage.getItem('lists'));
            // 抓清單
            if(lists){
                let total = document.querySelector('.total');
                
                
                let li ='';
                lists.forEach(function(item,i){
                    let price =''+ item.price * item.count;
                    let total_price = price;
                    
                    // console.log(price.length);
                    
                    price = thousandths(price);


                    li = `<li data-id='${item.item_id}'>
                        <div class="c_pic">
                            <img src="${item.pic}" alt="">
                            </div>
                            <h4>${item.name}</h4>
                            <div class="c_btn">
                                <button class='minus'> - </button>
                                <input class='many' type="text" onkeyup = "value=value.replace(/[^0123456789]/g,'')" placeholder="數量" value=${item.count} >
                                <button class='plus'>+</button>
                                </div>
                        <div>
                        <p data-price='${total_price}'>NT$ ${price}</p>
                        <button class='remove'>移除</button>
                        </div>
                        </li>`
                    let c_list = document.getElementsByClassName('c_list')[0];
                    c_list.insertAdjacentHTML("beforeend",li)
                })
                total_();
            }
        }
                document.addEventListener('click',function(e){
                let lists =JSON.parse(sessionStorage.getItem('lists'));
                // 移除
                if(e.target.classList.contains('remove')){
                    let con = confirm('移除?')
                    if(con){
                        let item_id = e.target.closest('li').getAttribute('data-id');
                            
                        let new_list = [];
                        lists.forEach(function(item,i){
                            if(item_id != item.item_id){
                                new_list.push(item)
                            };
                        });
                        sessionStorage.setItem('lists',JSON.stringify(new_list));
    
                        setTimeout(function(){
                            e.target.closest('li').remove();
                            total_();
                        },500)
                    };
                    change();
                };

                    
                let c_btn = e.target.closest('.c_btn');
                let many = c_btn.querySelector('input');
                    
                // 判斷按鈕
                    
                if(e.target.classList.contains('plus')){
                    many.value++;
                }else if(e.target.classList.contains('minus')){
                    many.value -=1;
                }
                    
                // 改數量
                    
                if(many.value < 1){
                    many.value = 1;
                }
                // 印價格
                    
                let show = e.target.closest('li').lastElementChild.querySelector('p');
                let get;
                for(let i = 0; i < lists.length; i++){
                    let item_id = e.target.closest('li').getAttribute('data-id');
                    
                    if(item_id == lists[i].item_id){
                        get = lists[i].price;
                    }
                }
                let price =''+ get * many.value;
                // console.log(price.length);
                show.setAttribute('data-price',price); //total
                // 價格千分位
                price = thousandths(price);

                show.innerText=`NT$ ${price}`;
                // total
                total_()
                    
            })
                // 鍵盤改數量
                document.addEventListener('keyup',function(e){
                    let many = e.target;
                    let show = e.target.closest('li').lastElementChild.querySelector('p');
                    let lists =JSON.parse(sessionStorage.getItem('lists'));
                    let get; //先宣告就能從for裡面帶出來
                    for(let i = 0; i < lists.length; i++){
                        let item_id = e.target.closest('li').getAttribute('data-id');
                        
                        if(item_id == lists[i].item_id){
                            get = lists[i].price;
                        }
                    }
                    if(many.value < 1){
                        many.value = 1;
                    }

                    let price =''+ get * many.value;
                    show.setAttribute('data-price',price); //total用

                    // 價格加千分位
                    price = thousandths(price);
                    
                    show.innerText=`NT$ ${price}`
                    total_();
                })
                

                // 價格千分位函數
                function thousandths(a){
                        if(a.length>3 && a.length <=6){
                            a = a.slice(0,-3) +',' +a.slice(-3);
                        }else if(a.length>6 && a.length<=9){
                            a = a.slice(0,-6) + ',' + a.slice(-6,-3) + ',' + a.slice(-3);    
                        }else if(a.length>9){
                            a = a.slice(0,-9) + ',' +  a.slice(-9,-6) + ',' + a.slice(-6,-3) + ',' + a.slice(-3);
                        }
                        return a;
                    }
                

                function total_(){
                        let c_lists = document.querySelector('.c_list').querySelectorAll('li');
                        let p_total = 0;

                        for(let i = 0; i < c_lists.length; i++){
                            let total_p = c_lists[i].querySelector('p').getAttribute('data-price'); 
                            p_total += Number(total_p);
                            // console.log(p_total);
                        }
                        
                        let plus_total = ''+p_total;
                        
                        plus_total = thousandths(plus_total);
                        
                        let total = document.querySelector('.total');
                        total.innerText=`NT$ ${plus_total}`;
                        }
                </script>
</body>
</html>